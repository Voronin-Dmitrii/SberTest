## Задание №2. Кластеризация устройств для оптимизации обслуживания

Цель работы — **объединить банкоматы в кластеры по географической близости**, чтобы оптимизировать процессы обслуживания и анализа заявок (`num_of_tickets`).

Используется метод **DBSCAN** (Density-Based Spatial Clustering of Applications with Noise), который группирует объекты по плотности на основе радиуса окрестности и не требует заранее задавать число кластеров.

---

## Этапы работы
1. **Подготовка данных**
   - Исходный файл: `test_task_2.csv`
   - Содержит поля:
     - `atm_id` — уникальный идентификатор банкомата  
     - `location_latitude`, `location_longitude` — координаты устройства  
     - `num_of_tickets` — количество заявок на обслуживание  

2. **Кластеризация**
   - Используется алгоритм `DBSCAN` с метрикой **Haversine**, которая подходит для работы с географическими координатами.
   - Радиус (`eps`) выбран **200 м** для:
     - Лучшей визуализации,  
     - Избежания чрезмерного слияния банкоматов (максимальное кол-во банкоматов в кластере - 22, для 500м - 125).  

3. **Агрегирование данных**
   - Полностью дублирующихся строк в исходном файле нет.
   - Агрегация данных **по `atm_id`**:
     - остаётся `atm_id` банкомата, у которого кол-во заявок больше,  
     - кол-во заявок суммируется,  
     - точно неизвество почему произошло дублирование `atm_id` (Предполагаю, что банкомат перехал и осталась старая запись, но даты внесения данных в исходном файле нет. Поэтому ссылаюсь на кол-во заявок)
   - Данные **не агрегировались** по одинаковым координатам, потому что:
     - неизвестна причина дублирования (предполагаю, что измеряли координаты помещения с банкоматами),  
     - в одной точке максимум 9 банкоматов, что вполне реально.

4. **Результаты**
   - К каждому банкомату добавлено поле `cluster` — номер кластера, к которому он относится.
   - Для каждого кластера рассчитаны:
     - количество банкоматов (`atm_count`),
     - суммарное число заявок (`total_tickets`),
     - средние координаты центра (`mean_lat`, `mean_lon`).

---

## Структура файлов проекта

| Файл | Назначение |
|------|-------------|
| `test_task_2.csv` | Исходные данные с координатами банкоматов и числом заявок |
| `test_task_2_with_clusters.csv` | Таблица банкоматов с добавленным номером кластера |
| `clusters_summary.csv` | Сводная таблица по кластерам: количество банкоматов, заявок, координаты центра |
| `clusters_200m_map.html` | Интерактивная карта (Folium) с визуализацией кластеров, границ и сумм заявок |
| `test_task_2_aggregated.csv` | Вспомогательный файл с агрегированными данными |
| `aggregation.py` | Агрегация данных по atm_id |
| `initial_check.py` | Проверка разных границ кластеризации на кол-во кластеров, потерю заявок, максимальное кол-во точек |
| `cluster.py` | Кластеризация с выводом в файл |
| `visualization.py` | Кластеризация с выводом на интерактивную карту (Folium) |

---

## Возможные улучшения
- Добавить автоматический подбор оптимального радиуса на основе анализа расстояний между банкоматами.  
- Интегрировать данные о маршрутах инженеров для расчёта реальной экономии времени.
